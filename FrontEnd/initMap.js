let map;
let heatmap;
let userMarker;

function initMap() {
  map = new google.maps.Map(document.getElementById("map"), {
    zoom: 20,
    center: {
      lat: 4.6399488,
      lng: -74.1605376
    },
    mapTypeId: "roadmap",
  });
  heatmap = new google.maps.visualization.HeatmapLayer({
    data: getPoints(),
    map: map,
  });

  // Obtén la ubicación del usuario y muestra un marcador en ese lugar
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition);
  } else {
    console.log("Geolocalización no es compatible con este navegador.");
  }
}

function toggleHeatmap() {
  heatmap.setMap(heatmap.getMap() ? null : map);
}

function changeGradient() {
  const gradient = [
    "rgba(0, 255, 255, 0)",
    "rgba(0, 255, 255, 1)",
    "rgba(0, 191, 255, 1)",
    "rgba(0, 127, 255, 1)",
    "rgba(0, 63, 255, 1)",
    "rgba(0, 0, 255, 1)",
    "rgba(0, 0, 223, 1)",
    "rgba(0, 0, 191, 1)",
    "rgba(0, 0, 159, 1)",
    "rgba(0, 0, 127, 1)",
    "rgba(63, 0, 91, 1)",
    "rgba(127, 0, 63, 1)",
    "rgba(191, 0, 31, 1)",
    "rgba(255, 0, 0, 1)",
  ];

  heatmap.set("gradient", heatmap.get("gradient") ? null : gradient);
}
/**
// Heatmap data: 500 Points
function getPoints() {
  return new Promise((resolve, reject) => {
    fetch('/coordinates')
      .then(response => response.json())
      .then(data => {
        const points = data.map(point => new google.maps.LatLng(point.lat, point.lng));
        resolve(points);
      })
      .catch(error => reject(error));
  });
}
**/
// Heatmap data: 500 Points
function getPoints() {
  return [
    new google.maps.LatLng( 4.6402356, -74.1565256),
    new google.maps.LatLng(4.6602356, -74.1565256),
new google.maps.LatLng(4.6549486, -74.1406592),
new google.maps.LatLng(4.657928, -74.137026),
new google.maps.LatLng(4.6588129, -74.1371748),
new google.maps.LatLng(4.6614595, -74.1452443),
new google.maps.LatLng(4.6579494, -74.1371064),
new google.maps.LatLng(4.6566475, -74.1388151),
new google.maps.LatLng(4.6553979, -74.1402707),
new google.maps.LatLng(4.6529639, -74.1430166),
new google.maps.LatLng(4.6480319, -74.148283),
new google.maps.LatLng(4.6444021, -74.1521425),
new google.maps.LatLng(4.6416894, -74.1551018),
new google.maps.LatLng(4.641364, -74.1554514),
new google.maps.LatLng(4.6411169, -74.1557133),
new google.maps.LatLng(4.6408044, -74.156052),
new google.maps.LatLng(4.6402784, -74.1566114),
new google.maps.LatLng(4.6396641, -74.1562228),
new google.maps.LatLng(4.6392944, -74.1559901),
new google.maps.LatLng(4.6388864, -74.1557392),
new google.maps.LatLng(4.638108, -74.1552483),
new google.maps.LatLng(4.6375931, -74.1550126),
new google.maps.LatLng(4.6365385, -74.1545196),
new google.maps.LatLng(4.6362538, -74.1543368),
new google.maps.LatLng(4.6361589, -74.1542751),
new google.maps.LatLng(4.636048, -74.1542296),
new google.maps.LatLng(4.6358582, -74.1541277),
new google.maps.LatLng(4.6357812, -74.1540859),
new google.maps.LatLng(4.6356471, -74.1540312),
new google.maps.LatLng(4.6353771, -74.1539133),
new google.maps.LatLng(4.6347775, -74.153338),
new google.maps.LatLng(4.6328524, -74.1514435),
new google.maps.LatLng(4.6317611, -74.1504012),
new google.maps.LatLng(4.6315676, -74.1500504),
new google.maps.LatLng(4.6312662, -74.1495461),
new google.maps.LatLng(4.6297342, -74.1482554),
new google.maps.LatLng(4.6281554, -74.1466858),
new google.maps.LatLng(4.6267301, -74.1452846),
new google.maps.LatLng(4.626383, -74.1453181),
new google.maps.LatLng(4.6260359, -74.1452658),
new google.maps.LatLng(4.625436, -74.1451516),
new google.maps.LatLng(4.6240698, -74.1463841),
new google.maps.LatLng(4.6202121, -74.1422199),
new google.maps.LatLng(4.6200403, -74.1420178),
new google.maps.LatLng(4.619786, -74.1418806),
new google.maps.LatLng(4.6191962, -74.1419004),
new google.maps.LatLng(4.6189678, -74.1406502),
new google.maps.LatLng(4.6185804, -74.1395056),
new google.maps.LatLng(4.6215283, -74.1387519),
new google.maps.LatLng(4.6246745, -74.1383174),
new google.maps.LatLng(4.6305606, -74.1378117),
new google.maps.LatLng(4.6347059, -74.1372996),
new google.maps.LatLng(4.6365885, -74.1369254),
new google.maps.LatLng(4.6391301, -74.1358726),
new google.maps.LatLng(4.6418166, -74.134254),
new google.maps.LatLng(4.6476601, -74.128833),
new google.maps.LatLng(4.6465673, -74.1301894),
new google.maps.LatLng(4.6458498, -74.1310393),
new google.maps.LatLng(4.64479, -74.1320822),
new google.maps.LatLng(4.644351, -74.1324408),
new google.maps.LatLng(4.6434706, -74.1330891),
new google.maps.LatLng(4.6418166, -74.134254),
new google.maps.LatLng(4.6409023, -74.1348119),
new google.maps.LatLng(4.6391301, -74.1358726),
new google.maps.LatLng(4.6384882, -74.1361718),
new google.maps.LatLng(4.6379157, -74.136456),
new google.maps.LatLng(4.6375533, -74.1365838),
new google.maps.LatLng(4.6365989, -74.1369218),
new google.maps.LatLng(4.6358931, -74.1370626),
new google.maps.LatLng(4.6346205, -74.137304),
new google.maps.LatLng(4.6314712, -74.1376607),
new google.maps.LatLng(4.6294995, -74.1378592),
new google.maps.LatLng(4.627338, -74.1380631),
new google.maps.LatLng(4.6262312, -74.1381704),
new google.maps.LatLng(4.625234, -74.1382589),
new google.maps.LatLng(4.6239828, -74.1384118),
new google.maps.LatLng(4.6228493, -74.1385781),
new google.maps.LatLng(4.6215283, -74.1387519),
new google.maps.LatLng(4.6204752, -74.1389804),
new google.maps.LatLng(4.6188048, -74.1394295),
new google.maps.LatLng(4.6187888, -74.1394388),
new google.maps.LatLng(4.6185804, -74.1395056),
new google.maps.LatLng(4.61263, -74.1344366),
new google.maps.LatLng(4.6123092, -74.1340826),
new google.maps.LatLng(4.61186, -74.1335247),
new google.maps.LatLng(4.609764, -74.1298125),
new google.maps.LatLng(4.609657, -74.1296516),
new google.maps.LatLng(4.6092186, -74.1292224),
new google.maps.LatLng(4.6100527, -74.128804),
new google.maps.LatLng(4.6102666, -74.1287289),
new google.maps.LatLng(4.6103949, -74.1286001),
new google.maps.LatLng(4.6134263, -74.1277664),
new google.maps.LatLng(4.6205592, -74.1254704),
new google.maps.LatLng(4.6326005, -74.1209429),
new google.maps.LatLng(4.6364165, -74.1192942),
new google.maps.LatLng(4.6373308, -74.1181677),
new google.maps.LatLng(4.6374164, -74.118275),
new google.maps.LatLng(4.6386889, -74.1204207),
new google.maps.LatLng(4.6409078, -74.123201),
new google.maps.LatLng(4.6407394, -74.1235014),
new google.maps.LatLng(4.6418346, -74.1242462),
new google.maps.LatLng(4.645074, -74.125312),
new google.maps.LatLng(4.6454285, -74.1255058),
new google.maps.LatLng(4.6456317, -74.1256881),
new google.maps.LatLng(4.6152356, -74.1625905),
new google.maps.LatLng(4.6138542, -74.1617767),
new google.maps.LatLng(4.6129068, -74.1613698),
new google.maps.LatLng(4.6117487, -74.1611878),
new google.maps.LatLng(4.6082395, -74.1616118),
new google.maps.LatLng(4.608089, -74.1614804),
new google.maps.LatLng(4.6059493, -74.1617139),
new google.maps.LatLng(4.6056882, -74.1607632),
new google.maps.LatLng(4.6054828, -74.1599338),
new google.maps.LatLng(4.605256, -74.1591044),
new google.maps.LatLng(4.6050207, -74.1586967),
new google.maps.LatLng(4.6046839, -74.1582301),
new google.maps.LatLng(4.6386552, -74.1586745),
new google.maps.LatLng(4.6360269, -74.1615445),
new google.maps.LatLng(4.6329388, -74.1649294),
new google.maps.LatLng(4.630228, -74.1678517),
new google.maps.LatLng(4.6295539, -74.1685316),
new google.maps.LatLng(4.6288842, -74.1694864),
new google.maps.LatLng(4.6279311, -74.1703984),
new google.maps.LatLng(4.6255714, -74.1692854),
new google.maps.LatLng(4.6252853, -74.1691513),
new google.maps.LatLng(4.6250634, -74.1690171),
new google.maps.LatLng(4.6248816, -74.1688884),
new google.maps.LatLng(4.6247159, -74.1687275),
new google.maps.LatLng(4.6245715, -74.1685236),
new google.maps.LatLng(4.6240795, -74.1678584),
new google.maps.LatLng(4.6221119, -74.166571),
new google.maps.LatLng(4.6186684, -74.1645754),
new google.maps.LatLng(4.6169627, -74.1635508),
new google.maps.LatLng(4.6152356, -74.1625905),
new google.maps.LatLng(4.616059, -74.1589535),
new google.maps.LatLng(4.6162783, -74.1576124),
new google.maps.LatLng(4.6165296, -74.1562498),
new google.maps.LatLng(4.6171338, -74.1528648),
new google.maps.LatLng(4.6177808, -74.1488791),
new google.maps.LatLng(4.6185187, -74.1461003),
new google.maps.LatLng(4.6190962, -74.1440833),
new google.maps.LatLng(4.6192786, -74.1434793),
new google.maps.LatLng(4.6193434, -74.1428217),
new google.maps.LatLng(4.6191962, -74.1419004),
new google.maps.LatLng(4.619786, -74.1418806),
new google.maps.LatLng(4.6200403, -74.1420178),
new google.maps.LatLng(4.6240698, -74.1463841),
new google.maps.LatLng(4.625436, -74.1451516),
new google.maps.LatLng(4.626383, -74.1453181),
new google.maps.LatLng(4.6267301, -74.1452846),
new google.maps.LatLng(4.6280482, -74.1465715),
new google.maps.LatLng(4.6298181, -74.1483149),
new google.maps.LatLng(4.6312662, -74.1495461),
new google.maps.LatLng(4.6318178, -74.1504446),
new google.maps.LatLng(4.6329772, -74.1515325),
new google.maps.LatLng(4.6353771, -74.1539133),
new google.maps.LatLng(4.6357812, -74.1540859),
new google.maps.LatLng(4.6361589, -74.1542751),
new google.maps.LatLng(4.6365385, -74.1545196),
new google.maps.LatLng(4.638108, -74.1552483),
new google.maps.LatLng(4.6387856, -74.1556876),
new google.maps.LatLng(4.6392944, -74.1559901),
new google.maps.LatLng(4.6402784, -74.1566114),
new google.maps.LatLng(4.6386552, -74.1586745),
new google.maps.LatLng(4.6257285, -74.1770036),
new google.maps.LatLng(4.62555, -74.1770193),
new google.maps.LatLng(4.6252912, -74.1770135),
new google.maps.LatLng(4.6249406, -74.1769495),
new google.maps.LatLng(4.62459, -74.176848),
new google.maps.LatLng(4.6244101, -74.176739),
new google.maps.LatLng(4.6242405, -74.1767067),
new google.maps.LatLng(4.6240763, -74.1766449),
new google.maps.LatLng(4.6240326, -74.1766889),
new google.maps.LatLng(4.6238741, -74.1767845),
new google.maps.LatLng(4.6238326, -74.1768864),
new google.maps.LatLng(4.6232244, -74.1778842),
new google.maps.LatLng(4.6230707, -74.1779687),
new google.maps.LatLng(4.6223301, -74.1773571),
new google.maps.LatLng(4.6219379, -74.177846),
new google.maps.LatLng(4.6218425, -74.1780532),
new google.maps.LatLng(4.6218068, -74.1780116),
new google.maps.LatLng(4.6214572, -74.1784273),
new google.maps.LatLng(4.6200148, -74.1799079),
new google.maps.LatLng(4.6192235, -74.1792863),
new google.maps.LatLng(4.6184268, -74.1802686),
new google.maps.LatLng(4.6186674, -74.1804309),
new google.maps.LatLng(4.6188385, -74.1805946),
new google.maps.LatLng(4.6189308, -74.1807152),
new google.maps.LatLng(4.6190123, -74.1809432),
new google.maps.LatLng(4.6190489, -74.1811738),
new google.maps.LatLng(4.6190829, -74.1814205),
new google.maps.LatLng(4.6190544, -74.1815973),
new google.maps.LatLng(4.6189388, -74.1818705),
new google.maps.LatLng(4.6188787, -74.1821407),
new google.maps.LatLng(4.6189535, -74.182091),
new google.maps.LatLng(4.6189081, -74.1821874),
new google.maps.LatLng(4.6189241, -74.1821924),
new google.maps.LatLng(4.6188546, -74.1823794),
new google.maps.LatLng(4.6188306, -74.1823888),
new google.maps.LatLng(4.6188306, -74.1824476),
new google.maps.LatLng(4.6188209, -74.1826453),
new google.maps.LatLng(4.6188392, -74.1827063),
new google.maps.LatLng(4.6187597, -74.18269),
new google.maps.LatLng(4.6188366, -74.1827849),
new google.maps.LatLng(4.6189134, -74.1829428),
new google.maps.LatLng(4.6189936, -74.1831775),
new google.maps.LatLng(4.6189509, -74.1833465),
new google.maps.LatLng(4.6191326, -74.1836522),
new google.maps.LatLng(4.6189856, -74.1840345),
new google.maps.LatLng(4.6188332, -74.184524),
new google.maps.LatLng(4.6187182, -74.1853917),
new google.maps.LatLng(4.6187062, -74.1854407),
new google.maps.LatLng(4.618654, -74.1854548),
new google.maps.LatLng(4.6570264, -74.170337),
new google.maps.LatLng(4.6572111, -74.1705905),
new google.maps.LatLng(4.6573929, -74.1711055),
new google.maps.LatLng(4.6574678, -74.1715024),
new google.maps.LatLng(4.6574624, -74.1719155),
new google.maps.LatLng(4.6573234, -74.1722266),
new google.maps.LatLng(4.6570347, -74.172586),
new google.maps.LatLng(4.6567192, -74.1730313),
new google.maps.LatLng(4.6563687, -74.1734545),
new google.maps.LatLng(4.6559516, -74.1740124),
new google.maps.LatLng(4.6555988, -74.1743665),
new google.maps.LatLng(4.6552031, -74.1746454),
new google.maps.LatLng(4.6549358, -74.1748064),
new google.maps.LatLng(4.6547005, -74.1751175),
new google.maps.LatLng(4.6546577, -74.1755788),
new google.maps.LatLng(4.6547968, -74.1759543),
new google.maps.LatLng(4.6548609, -74.1762333),
new google.maps.LatLng(4.6549037, -74.1765444),
new google.maps.LatLng(4.6548395, -74.1768234),
new google.maps.LatLng(4.6546684, -74.1771989),
new google.maps.LatLng(4.6543262, -74.1776388),
new google.maps.LatLng(4.653813, -74.1781323),
new google.maps.LatLng(4.6535349, -74.17854),
new google.maps.LatLng(4.6533531, -74.1788619),
new google.maps.LatLng(4.653043, -74.1786044),
new google.maps.LatLng(4.6529789, -74.1787117),
new google.maps.LatLng(4.6506691, -74.1769414),
new google.maps.LatLng(4.6447575, -74.1728701),
new google.maps.LatLng(4.640603, -74.1700162),
new google.maps.LatLng(4.6403143, -74.1697212),
new google.maps.LatLng(4.6395123, -74.1692705),
new google.maps.LatLng(4.6394535, -74.1692276),
new google.maps.LatLng(4.6394053, -74.1692384),
new google.maps.LatLng(4.639396, -74.1692464),
new google.maps.LatLng(4.638013, -74.1683814),
new google.maps.LatLng(4.6376708, -74.1680944),
new google.maps.LatLng(4.6329388, -74.1649294),
new google.maps.LatLng(4.6387589, -74.1585538),
new google.maps.LatLng(4.6388444, -74.1584465),
new google.maps.LatLng(4.6390208, -74.1581944),
new google.maps.LatLng(4.6402784, -74.1566114),
new google.maps.LatLng(4.6412081, -74.1573888),
new google.maps.LatLng(4.6427501, -74.1586745),
new google.maps.LatLng(4.6439478, -74.1596696),
new google.maps.LatLng(4.6472039, -74.1623792),
new google.maps.LatLng(4.6513788, -74.1658483),
new google.maps.LatLng(4.6527181, -74.1669427),
new google.maps.LatLng(4.6558101, -74.1695468),
new google.maps.LatLng(4.6329388, -74.1649294),
new google.maps.LatLng(4.6365882, -74.1673822),
new google.maps.LatLng(4.6376708, -74.1680944),
new google.maps.LatLng(4.638013, -74.1683814),
new google.maps.LatLng(4.6383954, -74.1686187),
new google.maps.LatLng(4.639396, -74.1692464),
new google.maps.LatLng(4.6394053, -74.1692384),
new google.maps.LatLng(4.6394535, -74.1692276),
new google.maps.LatLng(4.6395249, -74.1692863),
new google.maps.LatLng(4.6397442, -74.169399),
new google.maps.LatLng(4.6403143, -74.1697212),
new google.maps.LatLng(4.640603, -74.1700162),
new google.maps.LatLng(4.6414592, -74.17061),
new google.maps.LatLng(4.6434014, -74.1719256),
new google.maps.LatLng(4.6452541, -74.1732185),
new google.maps.LatLng(4.6463223, -74.1739465),
new google.maps.LatLng(4.6470614, -74.1744601),
new google.maps.LatLng(4.6478421, -74.1749952),
new google.maps.LatLng(4.65083, -74.1770628),
new google.maps.LatLng(4.6529789, -74.1787117),
new google.maps.LatLng(4.653043, -74.1786044),
new google.maps.LatLng(4.6533531, -74.1788619),
new google.maps.LatLng(4.6531056, -74.1794118),
new google.maps.LatLng(4.6526298, -74.1801628),
new google.maps.LatLng(4.652202, -74.1805384),
new google.maps.LatLng(4.6515818, -74.1808227),
new google.maps.LatLng(4.6511487, -74.1810319),
new google.maps.LatLng(4.6505339, -74.1814342),
new google.maps.LatLng(4.6502451, -74.1816756),
new google.maps.LatLng(4.6492346, -74.1824105),
new google.maps.LatLng(4.648716, -74.1829255),
new google.maps.LatLng(4.6483684, -74.1834083),
new google.maps.LatLng(4.6479407, -74.1839394),
new google.maps.LatLng(4.6475931, -74.1843739),
new google.maps.LatLng(4.6471173, -74.1850284),
new google.maps.LatLng(4.6469729, -74.1854039),
new google.maps.LatLng(4.646989, -74.1856882),
new google.maps.LatLng(4.6440594, -74.1843881),
new google.maps.LatLng(4.6356188, -74.1804735),
new google.maps.LatLng(4.6344878, -74.1798777),
new google.maps.LatLng(4.6336242, -74.1794995),
new google.maps.LatLng(4.6336082, -74.1795317),
new google.maps.LatLng(4.6329051, -74.1792045),
new google.maps.LatLng(4.6300525, -74.1779023),
new google.maps.LatLng(4.6297103, -74.1777239),
new google.maps.LatLng(4.6296863, -74.1777588),
new google.maps.LatLng(4.6288642, -74.1773645),
new google.maps.LatLng(4.6262365, -74.1771002),
new google.maps.LatLng(4.6257633, -74.1770197),
    
    // Agrega más puntos aquí
  ];
}


// Muestra la posición actual del usuario en el mapa
function showPosition(position) {
  if (!map) {
    // Si el mapa aún no se ha creado, espera hasta que se cargue
    return;
  }

  var userLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
  alert(userLocation);

  if (userMarker) {
    // Si ya existe un marcador de usuario, actualiza su posición
    userMarker.setPosition(userLocation);
  } else {
    // Si no existe un marcador de usuario, crea uno
    userMarker = new google.maps.Marker({
      position: userLocation,
      map: map,
      title: "Mi ubicación",
    });
  }

  // Centra el mapa en la ubicación del usuario
  map.setCenter(userLocation);
  map.setZoom(15); // Establece el zoom en 16 para acercar el mapa a la ubicación del usuario
}

window.initMap = initMap;
